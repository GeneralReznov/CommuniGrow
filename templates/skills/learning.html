{% extends "base.html" %}

{% block title %}Interactive Learning - Skills & Employment{% endblock %}

{% block head %}
<style>
.lesson-card {
    transition: transform 0.2s, box-shadow 0.2s;
    border: none;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}
.lesson-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.15);
}
.achievement-badge {
    animation: pulse 2s infinite;
}
@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}
.skill-level-badge {
    position: absolute;
    top: 10px;
    right: 10px;
    background: rgba(255,255,255,0.2);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.3);
}
.progress-ring {
    transform: rotate(-90deg);
}
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h2">
            <i class="fas fa-graduation-cap me-2"></i>
            Microlearning & Skill Development
        </h1>
        <button class="btn btn-outline-primary" onclick="speakText('Microlearning page. Choose from digital literacy, entrepreneurship, technical skills, or life skills modules. Each module contains practical lessons designed for community development.')">
            <i class="fas fa-volume-up me-2"></i>
            Page Guide
        </button>
    </div>

    <!-- Skills Assessment & Learning Path -->    
    <div class="row mb-5">
        <div class="col-12">
            <div class="card bg-gradient" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h4 class="text-black">🎯 Personalized Skills Assessment</h4>
                            <p class="mb-3 text-black">Discover your skill level and get a customized learning path based on your goals and experience.</p>
                            <button class="btn btn-light" onclick="startSkillAssessment()">
                                <i class="fas fa-chart-line me-2"></i>Take Skills Assessment
                            </button>
                        </div>
                        <div class="col-md-4 text-center">
                            <div class="position-relative d-inline-block">
                                <svg width="120" height="120" class="progress-ring">
                                    <circle cx="60" cy="60" r="50" stroke="rgba(255,255,255,0.3)" stroke-width="8" fill="none"/>
                                    <circle cx="60" cy="60" r="50" stroke="white" stroke-width="8" fill="none" 
                                            stroke-dasharray="314" stroke-dashoffset="251" id="progressCircle"/>
                                </svg>
                                <div class="position-absolute top-50 start-50 translate-middle text-center">
                                    <h5 class="mb-0" id="skillProgress">20%</h5>
                                    <small>Complete</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Learning Progress Dashboard -->
    <div class="row g-4 mb-5">
        <div class="col-md-3">
            <div class="stat-card text-center position-relative">
                <div class="stat-icon bg-success text-white">
                    <i class="fas fa-trophy"></i>
                </div>
                <h6 class="mt-3">Skills Mastered</h6>
                <h4 class="text-success" id="skillsCount">0</h4>
                <p class="text-muted small">Continue learning to unlock more</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card text-center">
                <div class="stat-icon bg-info text-white">
                    <i class="fas fa-clock"></i>
                </div>
                <h6 class="mt-3">Learning Time</h6>
                <h4 class="text-info" id="learningTime">0h</h4>
                <p class="text-muted small">Track your dedication</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card text-center">
                <div class="stat-icon bg-warning text-white">
                    <i class="fas fa-certificate"></i>
                </div>
                <h6 class="mt-3">Certificates</h6>
                <h4 class="text-warning" id="certificatesCount">0</h4>
                <p class="text-muted small">Earn recognition</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card text-center">
                <div class="stat-icon bg-danger text-white">
                    <i class="fas fa-users"></i>
                </div>
                <h6 class="mt-3">Community Rank</h6>
                <h4 class="text-danger" id="communityRank">#--</h4>
                <p class="text-muted small">Learn together</p>
            </div>
        </div>
    </div>

    <!-- Learning Modules -->
    <div class="row g-4">
        {% if modules %}
        {% for module_key, module in modules.items() %}
        <div class="col-lg-6">
            <div class="learning-module-card">
                <div class="module-header">
                    <div class="module-icon bg-{{ 'primary' if loop.index == 1 else 'success' if loop.index == 2 else 'warning' if loop.index == 3 else 'info' }}">
                        <i class="fas fa-{{ 'laptop' if 'digital' in module_key else 'business-time' if 'entrepreneur' in module_key else 'tools' if 'technical' in module_key else 'heart' }}"></i>
                    </div>
                    <div class="module-info">
                        <h5>{{ module.title }}</h5>
                        <p class="text-muted mb-0">{{ module.lessons|length }} lessons available</p>
                    </div>
                </div>
                
                <div class="module-content">
                    <div class="lessons-preview">
                        <h6 class="small fw-bold mb-2">What You'll Learn:</h6>
                        <ul class="lesson-list">
                            {% for lesson in module.lessons[:3] %}
                            <li>
                                <i class="fas fa-check-circle text-success me-2"></i>
                                {{ lesson }}
                            </li>
                            {% endfor %}
                            {% if module.lessons|length > 3 %}
                            <li class="text-muted">
                                <i class="fas fa-plus me-2"></i>
                                {{ module.lessons|length - 3 }} more lessons...
                            </li>
                            {% endif %}
                        </ul>
                    </div>
                </div>
                
                <div class="module-footer">
                    <div class="d-flex gap-2">
                        <button class="btn btn-outline-primary btn-sm" onclick="previewModule('{{ module_key }}', '{{ module.title }}')">
                            <i class="fas fa-eye me-1"></i>
                            Preview
                        </button>
                        <button class="btn btn-primary flex-grow-1" onclick="startModule('{{ module_key }}', '{{ module.title }}')">
                            <i class="fas fa-play me-1"></i>
                            Start Learning
                        </button>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <!-- Default modules -->
        <div class="col-lg-6">
            <div class="learning-module-card">
                <div class="module-header">
                    <div class="module-icon bg-primary">
                        <i class="fas fa-laptop"></i>
                    </div>
                    <div class="module-info">
                        <h5>Digital Literacy Basics</h5>
                        <p class="text-muted mb-0">5 lessons available</p>
                    </div>
                </div>
                
                <div class="module-content">
                    <div class="lessons-preview">
                        <h6 class="small fw-bold mb-2">What You'll Learn:</h6>
                        <ul class="lesson-list">
                            <li><i class="fas fa-check-circle text-success me-2"></i>Computer fundamentals</li>
                            <li><i class="fas fa-check-circle text-success me-2"></i>Internet safety</li>
                            <li><i class="fas fa-check-circle text-success me-2"></i>Email communication</li>
                            <li class="text-muted"><i class="fas fa-plus me-2"></i>2 more lessons...</li>
                        </ul>
                    </div>
                </div>
                
                <div class="module-footer">
                    <div class="d-flex gap-2">
                        <button class="btn btn-outline-primary btn-sm" onclick="previewModule('digital_literacy', 'Digital Literacy Basics')">
                            <i class="fas fa-eye me-1"></i>Preview
                        </button>
                        <button class="btn btn-primary flex-grow-1" onclick="startModule('digital_literacy', 'Digital Literacy Basics')">
                            <i class="fas fa-play me-1"></i>Start Learning
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-6">
            <div class="learning-module-card">
                <div class="module-header">
                    <div class="module-icon bg-success">
                        <i class="fas fa-business-time"></i>
                    </div>
                    <div class="module-info">
                        <h5>Small Business Development</h5>
                        <p class="text-muted mb-0">5 lessons available</p>
                    </div>
                </div>
                
                <div class="module-content">
                    <div class="lessons-preview">
                        <h6 class="small fw-bold mb-2">What You'll Learn:</h6>
                        <ul class="lesson-list">
                            <li><i class="fas fa-check-circle text-success me-2"></i>Business plan creation</li>
                            <li><i class="fas fa-check-circle text-success me-2"></i>Financial management</li>
                            <li><i class="fas fa-check-circle text-success me-2"></i>Marketing strategies</li>
                            <li class="text-muted"><i class="fas fa-plus me-2"></i>2 more lessons...</li>
                        </ul>
                    </div>
                </div>
                
                <div class="module-footer">
                    <div class="d-flex gap-2">
                        <button class="btn btn-outline-primary btn-sm" onclick="previewModule('entrepreneurship', 'Small Business Development')">
                            <i class="fas fa-eye me-1"></i>Preview
                        </button>
                        <button class="btn btn-primary flex-grow-1" onclick="startModule('entrepreneurship', 'Small Business Development')">
                            <i class="fas fa-play me-1"></i>Start Learning
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-6">
            <div class="learning-module-card">
                <div class="module-header">
                    <div class="module-icon bg-warning">
                        <i class="fas fa-tools"></i>
                    </div>
                    <div class="module-info">
                        <h5>Technical Skills Training</h5>
                        <p class="text-muted mb-0">5 lessons available</p>
                    </div>
                </div>
                
                <div class="module-content">
                    <div class="lessons-preview">
                        <h6 class="small fw-bold mb-2">What You'll Learn:</h6>
                        <ul class="lesson-list">
                            <li><i class="fas fa-check-circle text-success me-2"></i>Basic computer repair</li>
                            <li><i class="fas fa-check-circle text-success me-2"></i>Mobile phone services</li>
                            <li><i class="fas fa-check-circle text-success me-2"></i>Agricultural technology</li>
                            <li class="text-muted"><i class="fas fa-plus me-2"></i>2 more lessons...</li>
                        </ul>
                    </div>
                </div>
                
                <div class="module-footer">
                    <div class="d-flex gap-2">
                        <button class="btn btn-outline-primary btn-sm" onclick="previewModule('technical_skills', 'Technical Skills Training')">
                            <i class="fas fa-eye me-1"></i>Preview
                        </button>
                        <button class="btn btn-primary flex-grow-1" onclick="startModule('technical_skills', 'Technical Skills Training')">
                            <i class="fas fa-play me-1"></i>Start Learning
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-6">
            <div class="learning-module-card">
                <div class="module-header">
                    <div class="module-icon bg-info">
                        <i class="fas fa-heart"></i>
                    </div>
                    <div class="module-info">
                        <h5>Life Skills Development</h5>
                        <p class="text-muted mb-0">5 lessons available</p>
                    </div>
                </div>
                
                <div class="module-content">
                    <div class="lessons-preview">
                        <h6 class="small fw-bold mb-2">What You'll Learn:</h6>
                        <ul class="lesson-list">
                            <li><i class="fas fa-check-circle text-success me-2"></i>Communication skills</li>
                            <li><i class="fas fa-check-circle text-success me-2"></i>Time management</li>
                            <li><i class="fas fa-check-circle text-success me-2"></i>Problem solving</li>
                            <li class="text-muted"><i class="fas fa-plus me-2"></i>2 more lessons...</li>
                        </ul>
                    </div>
                </div>
                
                <div class="module-footer">
                    <div class="d-flex gap-2">
                        <button class="btn btn-outline-primary btn-sm" onclick="previewModule('life_skills', 'Life Skills Development')">
                            <i class="fas fa-eye me-1"></i>Preview
                        </button>
                        <button class="btn btn-primary flex-grow-1" onclick="startModule('life_skills', 'Life Skills Development')">
                            <i class="fas fa-play me-1"></i>Start Learning
                        </button>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Learning Tips -->
    <div class="row mt-5">
        <div class="col-12">
            <div class="card bg-light">
                <div class="card-body">
                    <h5 class="card-title">
                        <i class="fas fa-lightbulb me-2"></i>
                        Learning Tips for Success
                    </h5>
                    <div class="row g-3">
                        <div class="col-md-3">
                            <div class="tip-item">
                                <i class="fas fa-clock text-primary me-2"></i>
                                <strong>Set aside time:</strong> Even 15 minutes daily can make a big difference
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="tip-item">
                                <i class="fas fa-repeat text-success me-2"></i>
                                <strong>Practice regularly:</strong> Apply what you learn in real situations
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="tip-item">
                                <i class="fas fa-users text-info me-2"></i>
                                <strong>Learn together:</strong> Form study groups with community members
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="tip-item">
                                <i class="fas fa-question-circle text-warning me-2"></i>
                                <strong>Ask questions:</strong> Use the community forum for help and support
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Module Preview Modal -->
<div class="modal fade" id="modulePreviewModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modulePreviewTitle">
                    <i class="fas fa-eye me-2"></i>
                    Module Preview
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="modulePreviewContent">
                <!-- Content will be loaded here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="startFromPreview">
                    <i class="fas fa-play me-2"></i>
                    Start This Module
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Learning Session Modal -->
<div class="modal fade" id="learningSessionModal" tabindex="-1" data-bs-backdrop="static">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="learningSessionTitle">
                    <i class="fas fa-graduation-cap me-2"></i>
                    Learning Session
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" onclick="confirmExitLearning()"></button>
            </div>
            <div class="modal-body" id="learningSessionContent">
                <!-- Learning content will be loaded here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="confirmExitLearning()">Exit</button>
                <button type="button" class="btn btn-outline-primary" id="prevLessonBtn" style="display: none;">
                    <i class="fas fa-arrow-left me-2"></i>Previous
                </button>
                <button type="button" class="btn btn-primary" id="nextLessonBtn">
                    Next <i class="fas fa-arrow-right ms-2"></i>
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
let currentModule = null;
let currentLesson = 0;
let moduleData = {};

// Module content data
const modules = {
    digital_literacy: {
        title: 'Digital Literacy Basics',
        lessons: [
            {
                title: 'Computer Fundamentals',
                content: 'Learn the basic parts of a computer, how to turn it on/off safely, and navigate the desktop interface.',
                activities: ['Identify computer components', 'Practice mouse and keyboard use', 'Navigate desktop']
            },
            {
                title: 'Internet Safety',
                content: 'Understand how to browse the internet safely, recognize scams, and protect your personal information.',
                activities: ['Create strong passwords', 'Identify phishing emails', 'Use secure websites']
            },
            {
                title: 'Email Communication',
                content: 'Learn to create an email account, send and receive emails, and use email for professional communication.',
                activities: ['Set up email account', 'Compose professional emails', 'Manage email folders']
            },
            {
                title: 'Online Job Applications',
                content: 'Discover how to search for jobs online, create digital resumes, and submit applications through job portals.',
                activities: ['Create digital resume', 'Search job portals', 'Submit applications']
            },
            {
                title: 'Digital Banking Basics',
                content: 'Understand online banking, mobile payment apps, and how to manage finances digitally and securely.',
                activities: ['Navigate banking websites', 'Use mobile payment apps', 'Track expenses digitally']
            }
        ]
    },
    entrepreneurship: {
        title: 'Small Business Development',
        lessons: [
            {
                title: 'Business Plan Creation',
                content: 'Learn to identify business opportunities, write a simple business plan, and set realistic goals.',
                activities: ['Identify market opportunities', 'Write business description', 'Set SMART goals']
            },
            {
                title: 'Financial Management',
                content: 'Understand basic accounting, budgeting, and how to track income and expenses for your business.',
                activities: ['Create business budget', 'Track income/expenses', 'Calculate profit margins']
            },
            {
                title: 'Marketing Strategies',
                content: 'Discover low-cost marketing methods, social media promotion, and how to reach your target customers.',
                activities: ['Create marketing plan', 'Design simple advertisements', 'Use social media effectively']
            },
            {
                title: 'Customer Service',
                content: 'Learn how to provide excellent customer service, handle complaints, and build customer loyalty.',
                activities: ['Practice communication skills', 'Handle difficult situations', 'Build customer relationships']
            },
            {
                title: 'Legal Requirements',
                content: 'Understand basic business licenses, taxes, and legal considerations for small businesses.',
                activities: ['Research license requirements', 'Understand tax obligations', 'Know employment laws']
            }
        ]
    },
    technical_skills: {
        title: 'Technical Skills Training',
        lessons: [
            {
                title: 'Basic Computer Repair',
                content: 'Learn to diagnose common computer problems, perform basic maintenance, and when to seek professional help.',
                activities: ['Identify hardware issues', 'Clean computer components', 'Install software updates']
            },
            {
                title: 'Mobile Phone Services',
                content: 'Understand smartphone features, app installation, and basic troubleshooting for mobile devices.',
                activities: ['Navigate smartphone settings', 'Install and manage apps', 'Troubleshoot common issues']
            },
            {
                title: 'Agricultural Technology',
                content: 'Discover modern farming tools, weather monitoring apps, and technology for sustainable agriculture.',
                activities: ['Use weather apps', 'Learn irrigation systems', 'Monitor crop health digitally']
            },
            {
                title: 'Renewable Energy Basics',
                content: 'Learn about solar panels, wind energy, and how renewable energy systems can benefit communities.',
                activities: ['Calculate energy needs', 'Understand solar installation', 'Maintain energy systems']
            },
            {
                title: 'Water System Maintenance',
                content: 'Understand water purification, pump maintenance, and basic plumbing for community water systems.',
                activities: ['Test water quality', 'Maintain water pumps', 'Fix basic plumbing issues']
            }
        ]
    },
    life_skills: {
        title: 'Life Skills Development',
        lessons: [
            {
                title: 'Communication Skills',
                content: 'Develop effective verbal and written communication skills for personal and professional settings.',
                activities: ['Practice active listening', 'Give clear presentations', 'Write effective messages']
            },
            {
                title: 'Time Management',
                content: 'Learn to prioritize tasks, create schedules, and balance work and personal responsibilities.',
                activities: ['Create daily schedules', 'Set priorities', 'Use time-tracking tools']
            },
            {
                title: 'Problem Solving',
                content: 'Develop analytical thinking skills to identify problems, brainstorm solutions, and make decisions.',
                activities: ['Analyze real problems', 'Brainstorm solutions', 'Evaluate decision outcomes']
            },
            {
                title: 'Leadership Development',
                content: 'Learn to motivate others, delegate tasks, and lead community projects effectively.',
                activities: ['Practice leadership styles', 'Delegate responsibilities', 'Motivate team members']
            },
            {
                title: 'Conflict Resolution',
                content: 'Understand how to mediate disputes, find common ground, and maintain healthy relationships.',
                activities: ['Practice mediation skills', 'Role-play conflict scenarios', 'Find win-win solutions']
            }
        ]
    }
};

function previewModule(moduleKey, moduleTitle) {
    const module = modules[moduleKey];
    if (!module) return;
    
    document.getElementById('modulePreviewTitle').innerHTML = `
        <i class="fas fa-eye me-2"></i>
        ${moduleTitle} - Preview
    `;
    
    let previewContent = `
        <div class="module-overview">
            <h6 class="mb-3">Module Overview</h6>
            <p class="mb-4">This module contains ${module.lessons.length} comprehensive lessons designed to build practical skills for community development.</p>
            
            <h6 class="mb-3">Lesson Structure</h6>
            <div class="row g-3">
    `;
    
    module.lessons.forEach((lesson, index) => {
        previewContent += `
            <div class="col-md-6">
                <div class="lesson-preview-card">
                    <div class="d-flex align-items-start">
                        <div class="lesson-number">${index + 1}</div>
                        <div class="lesson-info">
                            <h6 class="mb-1">${lesson.title}</h6>
                            <p class="small text-muted mb-2">${lesson.content}</p>
                            <div class="activities">
                                <small class="fw-bold">Key Activities:</small>
                                <ul class="small mb-0">
                                    ${lesson.activities.slice(0, 2).map(activity => `<li>${activity}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    });
    
    previewContent += `
            </div>
            
            <div class="learning-format mt-4">
                <h6 class="mb-3">Learning Format</h6>
                <div class="row g-3">
                    <div class="col-md-4">
                        <div class="format-item">
                            <i class="fas fa-book-open text-primary me-2"></i>
                            <span>Interactive lessons with real examples</span>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="format-item">
                            <i class="fas fa-tasks text-success me-2"></i>
                            <span>Hands-on activities and exercises</span>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="format-item">
                            <i class="fas fa-volume-up text-info me-2"></i>
                            <span>Voice-enabled for accessibility</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    document.getElementById('modulePreviewContent').innerHTML = previewContent;
    
    document.getElementById('startFromPreview').onclick = () => {
        bootstrap.Modal.getInstance(document.getElementById('modulePreviewModal')).hide();
        startModule(moduleKey, moduleTitle);
    };
    
    const previewModal = new bootstrap.Modal(document.getElementById('modulePreviewModal'));
    previewModal.show();
    
    speakText(`Previewing ${moduleTitle}. This module contains ${module.lessons.length} lessons covering practical skills for community development.`);
}

function startModule(moduleKey, moduleTitle) {
    currentModule = moduleKey;
    currentLesson = 0;
    moduleData = modules[moduleKey];
    
    if (!moduleData) {
        alert('Module content not available. Please try again later.');
        return;
    }
    
    document.getElementById('learningSessionTitle').innerHTML = `
        <i class="fas fa-graduation-cap me-2"></i>
        ${moduleTitle} - Lesson ${currentLesson + 1}
    `;
    
    loadCurrentLesson();
    
    const learningModal = new bootstrap.Modal(document.getElementById('learningSessionModal'));
    learningModal.show();
    
    speakText(`Starting ${moduleTitle}. You are now beginning lesson 1: ${moduleData.lessons[0].title}`);
}

function loadCurrentLesson() {
    const lesson = moduleData.lessons[currentLesson];
    if (!lesson) return;
    
    document.getElementById('learningSessionTitle').innerHTML = `
        <i class="fas fa-graduation-cap me-2"></i>
        ${moduleData.title} - Lesson ${currentLesson + 1}: ${lesson.title}
    `;
    
    let lessonContent = `
        <div class="lesson-content">
            <div class="lesson-header mb-4">
                <div class="progress mb-3">
                    <div class="progress-bar" style="width: ${((currentLesson + 1) / moduleData.lessons.length) * 100}%"></div>
                </div>
                <h4>${lesson.title}</h4>
                <p class="text-muted">Lesson ${currentLesson + 1} of ${moduleData.lessons.length}</p>
            </div>
            
            <div class="lesson-body">
                <div class="content-section mb-4">
                    <h6>What You'll Learn</h6>
                    <p>${lesson.content}</p>
                </div>
                
                <div class="activities-section mb-4">
                    <h6>Practice Activities</h6>
                    <div class="activity-list">
                        ${lesson.activities.map((activity, index) => `
                            <div class="activity-item">
                                <div class="activity-checkbox">
                                    <input type="checkbox" class="form-check-input" id="activity${index}">
                                    <label class="form-check-label" for="activity${index}">
                                        ${activity}
                                    </label>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="lesson-tips">
                    <div class="alert alert-info">
                        <h6 class="alert-heading">
                            <i class="fas fa-lightbulb me-2"></i>
                            Learning Tip
                        </h6>
                        <p class="mb-0">Take your time with each activity. Practice in real situations when possible, and don't hesitate to repeat lessons as needed.</p>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    document.getElementById('learningSessionContent').innerHTML = lessonContent;
    
    // Update navigation buttons
    document.getElementById('prevLessonBtn').style.display = currentLesson > 0 ? 'inline-block' : 'none';
    document.getElementById('nextLessonBtn').textContent = currentLesson < moduleData.lessons.length - 1 ? 'Next Lesson' : 'Complete Module';
    
    // Set up navigation
    document.getElementById('prevLessonBtn').onclick = () => {
        if (currentLesson > 0) {
            currentLesson--;
            loadCurrentLesson();
        }
    };
    
    document.getElementById('nextLessonBtn').onclick = () => {
        if (currentLesson < moduleData.lessons.length - 1) {
            currentLesson++;
            loadCurrentLesson();
            speakText(`Moving to lesson ${currentLesson + 1}: ${moduleData.lessons[currentLesson].title}`);
        } else {
            completeModule();
        }
    };
}

function completeModule() {
    speakText(`Congratulations! You have completed the ${moduleData.title} module. Well done on building these valuable skills for community development.`);
    
    document.getElementById('learningSessionContent').innerHTML = `
        <div class="completion-screen text-center py-5">
            <i class="fas fa-trophy fa-4x text-warning mb-4"></i>
            <h3>Module Completed!</h3>
            <p class="lead mb-4">Congratulations! You've successfully completed the <strong>${moduleData.title}</strong> module.</p>
            
            <div class="completion-stats mb-4">
                <div class="row g-3">
                    <div class="col-md-4">
                        <div class="stat-item">
                            <h5 class="text-primary">${moduleData.lessons.length}</h5>
                            <small class="text-muted">Lessons Completed</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="stat-item">
                            <h5 class="text-success">${moduleData.lessons.reduce((acc, lesson) => acc + lesson.activities.length, 0)}</h5>
                            <small class="text-muted">Activities Practiced</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="stat-item">
                            <h5 class="text-info">1</h5>
                            <small class="text-muted">Skill Gained</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="next-steps">
                <h6>What's Next?</h6>
                <p>Continue building your skills with another learning module, or start applying what you've learned in real situations.</p>
                <div class="d-flex gap-2 justify-content-center">
                    <button class="btn btn-outline-primary" onclick="shareAchievement()">
                        <i class="fas fa-share me-2"></i>Share Achievement
                    </button>
                    <button class="btn btn-primary" onclick="chooseNextModule()">
                        <i class="fas fa-graduation-cap me-2"></i>Continue Learning
                    </button>
                </div>
            </div>
        </div>
    `;
    
    document.getElementById('nextLessonBtn').textContent = 'Close';
    document.getElementById('nextLessonBtn').onclick = () => {
        bootstrap.Modal.getInstance(document.getElementById('learningSessionModal')).hide();
        location.reload();
    };
}

function confirmExitLearning() {
    if (confirm('Are you sure you want to exit this learning session? Your progress will not be saved.')) {
        bootstrap.Modal.getInstance(document.getElementById('learningSessionModal')).hide();
    }
}

function shareAchievement() {
    speakText('Sharing your learning achievement with the community to inspire others!');
    alert('Achievement shared! Your progress inspires others in the community to keep learning.');
}

function chooseNextModule() {
    bootstrap.Modal.getInstance(document.getElementById('learningSessionModal')).hide();
    speakText('Choose your next learning module to continue building valuable skills.');
}

// Voice command handling for learning page
function handleLearningVoiceCommand(command) {
    const lowerCommand = command.toLowerCase();
    
    if (lowerCommand.includes('digital') || lowerCommand.includes('computer')) {
        startModule('digital_literacy', 'Digital Literacy Basics');
    } else if (lowerCommand.includes('business') || lowerCommand.includes('entrepreneur')) {
        startModule('entrepreneurship', 'Small Business Development');
    } else if (lowerCommand.includes('technical') || lowerCommand.includes('repair')) {
        startModule('technical_skills', 'Technical Skills Training');
    } else if (lowerCommand.includes('life') || lowerCommand.includes('communication')) {
        startModule('life_skills', 'Life Skills Development');
    } else if (lowerCommand.includes('preview')) {
        speakText('Which module would you like to preview? Say digital literacy, business development, technical skills, or life skills.');
    }
}

// Set up voice command handling
if (typeof window.globalVoiceHandler !== 'undefined') {
    window.globalVoiceHandler = handleLearningVoiceCommand;
}

// Skills Assessment System
function startSkillAssessment() {
    const assessmentModal = `
        <div class="modal fade" id="skillAssessmentModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">🎯 Skills Assessment</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div id="assessmentContent">
                            <h6>Select your primary area of interest:</h6>
                            <div class="row g-3 mb-4">
                                <div class="col-md-6">
                                    <button class="btn btn-outline-primary w-100" onclick="loadAssessment('digital_literacy')">
                                        💻 Digital & Technology Skills
                                    </button>
                                </div>
                                <div class="col-md-6">
                                    <button class="btn btn-outline-success w-100" onclick="loadAssessment('entrepreneurship')">
                                        🏪 Business & Entrepreneurship
                                    </button>
                                </div>
                                <div class="col-md-6">
                                    <button class="btn btn-outline-warning w-100" onclick="loadAssessment('technical_skills')">
                                        🔧 Technical & Repair Skills
                                    </button>
                                </div>
                                <div class="col-md-6">
                                    <button class="btn btn-outline-info w-100" onclick="loadAssessment('life_skills')">
                                        💪 Life & Communication Skills
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', assessmentModal);
    const modal = new bootstrap.Modal(document.getElementById('skillAssessmentModal'));
    modal.show();
    
    // Clean up modal when closed
    document.getElementById('skillAssessmentModal').addEventListener('hidden.bs.modal', function () {
        this.remove();
    });
}

function loadAssessment(skillArea) {
    const assessments = {
        digital_literacy: [
            { q: "How comfortable are you with using computers?", type: "scale" },
            { q: "Can you send emails and attach files?", type: "yesno" },
            { q: "Have you used online banking or digital payments?", type: "yesno" },
            { q: "How often do you use smartphones/tablets?", type: "frequency" }
        ],
        entrepreneurship: [
            { q: "Have you ever run a small business or sold products/services?", type: "yesno" },
            { q: "How confident are you in managing money and budgets?", type: "scale" },
            { q: "Can you create a simple business plan?", type: "yesno" },
            { q: "How comfortable are you talking to customers?", type: "scale" }
        ],
        technical_skills: [
            { q: "Can you identify and fix basic problems with equipment?", type: "yesno" },
            { q: "How comfortable are you with tools and manual work?", type: "scale" },
            { q: "Have you worked with electrical or mechanical systems?", type: "yesno" },
            { q: "Can you follow technical instructions and diagrams?", type: "scale" }
        ],
        life_skills: [
            { q: "How confident are you in public speaking?", type: "scale" },
            { q: "Can you organize and lead group activities?", type: "yesno" },
            { q: "How well do you handle conflicts and disputes?", type: "scale" },
            { q: "Are you comfortable teaching others new skills?", type: "yesno" }
        ]
    };
    
    const questions = assessments[skillArea] || [];
    let html = `
        <h6>Assessment: ${skillArea.replace('_', ' ').toUpperCase()}</h6>
        <form id="assessmentForm" onsubmit="submitAssessment(event, '${skillArea}')">
    `;
    
    questions.forEach((q, index) => {
        html += `<div class="mb-3">
            <label class="form-label">${q.q}</label>`;
        
        if (q.type === 'scale') {
            html += `
                <div class="btn-group w-100" role="group">
                    <input type="radio" class="btn-check" name="q${index}" id="q${index}_1" value="1" required>
                    <label class="btn btn-outline-danger" for="q${index}_1">Low</label>
                    <input type="radio" class="btn-check" name="q${index}" id="q${index}_2" value="2">
                    <label class="btn btn-outline-warning" for="q${index}_2">Basic</label>
                    <input type="radio" class="btn-check" name="q${index}" id="q${index}_3" value="3">
                    <label class="btn btn-outline-info" for="q${index}_3">Good</label>
                    <input type="radio" class="btn-check" name="q${index}" id="q${index}_4" value="4">
                    <label class="btn btn-outline-success" for="q${index}_4">Expert</label>
                </div>`;
        } else if (q.type === 'yesno') {
            html += `
                <div class="btn-group w-100" role="group">
                    <input type="radio" class="btn-check" name="q${index}" id="q${index}_yes" value="yes" required>
                    <label class="btn btn-outline-success" for="q${index}_yes">Yes</label>
                    <input type="radio" class="btn-check" name="q${index}" id="q${index}_no" value="no">
                    <label class="btn btn-outline-secondary" for="q${index}_no">No</label>
                </div>`;
        } else if (q.type === 'frequency') {
            html += `
                <select class="form-select" name="q${index}" required>
                    <option value="">Choose...</option>
                    <option value="daily">Daily</option>
                    <option value="weekly">Weekly</option>
                    <option value="monthly">Monthly</option>
                    <option value="rarely">Rarely</option>
                </select>`;
        }
        html += '</div>';
    });
    
    html += `
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-chart-line me-2"></i>Get My Assessment
            </button>
        </form>
    `;
    
    document.getElementById('assessmentContent').innerHTML = html;
}

function submitAssessment(event, skillArea) {
    event.preventDefault();
    const formData = new FormData(event.target);
    const responses = Object.fromEntries(formData.entries());
    
    fetch('/skills/api/skill-assessment', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            skill_area: skillArea,
            responses: responses
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            document.getElementById('assessmentContent').innerHTML = `
                <div class="alert alert-success">
                    <h6>🎯 Your Skills Assessment Results</h6>
                    <div style="white-space: pre-wrap; line-height: 1.6;">${data.assessment.result}</div>
                </div>
                <div class="text-center mt-3">
                    <a href="${window.location.pathname}" class="btn btn-primary">
                        <i class="fas fa-arrow-right me-2"></i>Start Learning Based on Assessment
                    </a>
                </div>
            `;
            updateProgressFromAssessment(skillArea);
        } else {
            alert('Assessment service unavailable. Please try again later.');
        }
    })
    .catch(error => {
        console.error('Assessment error:', error);
        alert('Error processing assessment. Please try again.');
    });
}

function updateProgressFromAssessment(skillArea) {
    // Update local storage and UI elements
    const progress = JSON.parse(localStorage.getItem('skillProgress') || '{}');
    progress[skillArea] = {
        assessed: true,
        date: new Date().toISOString(),
        level: Math.floor(Math.random() * 3) + 1 // Simulate assessment result
    };
    localStorage.setItem('skillProgress', JSON.stringify(progress));
    
    // Update progress displays
    const completedSkills = Object.keys(progress).length;
    document.getElementById('skillsCount').textContent = completedSkills;
    
    const totalProgress = Math.min((completedSkills / 4) * 100, 100);
    document.getElementById('skillProgress').textContent = `${Math.round(totalProgress)}%`;
    
    const progressCircle = document.getElementById('progressCircle');
    if (progressCircle) {
        const circumference = 314; // 2 * π * 50
        const dashOffset = circumference - (totalProgress / 100) * circumference;
        progressCircle.style.strokeDashoffset = dashOffset;
    }
}

// Load saved progress on page load
document.addEventListener('DOMContentLoaded', function() {
    const progress = JSON.parse(localStorage.getItem('skillProgress') || '{}');
    const completedSkills = Object.keys(progress).length;
    
    document.getElementById('skillsCount').textContent = completedSkills;
    document.getElementById('learningTime').textContent = completedSkills * 2 + 'h';
    document.getElementById('certificatesCount').textContent = Math.floor(completedSkills / 2);
    document.getElementById('communityRank').textContent = completedSkills > 0 ? `#${Math.max(1, 100 - completedSkills * 15)}` : '#--';
    
    const totalProgress = Math.min((completedSkills / 4) * 100, 100);
    document.getElementById('skillProgress').textContent = `${Math.round(totalProgress)}%`;
    
    const progressCircle = document.getElementById('progressCircle');
    if (progressCircle) {
        const circumference = 314;
        const dashOffset = circumference - (totalProgress / 100) * circumference;
        progressCircle.style.strokeDashoffset = dashOffset;
    }
});
</script>
{% endblock %}
